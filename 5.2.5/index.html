<!DOCTYPE HTML><html><head><title>RTI Perftest &mdash; RTI Perftest 5.2.5</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="generator" content="https://github.com/raml2html/raml2html 3.0.1"><link rel="stylesheet" href="css/bootstrap.min.css"><link rel="stylesheet" href="css/default.min.css"><script type="text/javascript" src="js/jquery-1.11.0.min.js"></script><script type="text/javascript" src="js/bootstrap.min.js"></script><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript">
      function getHost() {
          hostname = window.location.host;
          if(hostname == "") {
              hostname = "localhost:8080";
          }
          return hostname;
       }

      $(document).ready(function() {
        $('.page-header pre code, .top-resource-description pre code, .modal-body pre code').each(function(i, block) {
          hljs.highlightBlock(block);
        });

        $('[data-toggle]').click(function() {
          var selector = $(this).data('target') + ' pre code';
          $(selector).each(function(i, block) {
            hljs.highlightBlock(block);
          });
        });

        // open modal on hashes like #_action_get
        $(window).bind('hashchange', function(e) {
          var anchor_id = document.location.hash.substr(1); //strip #
          var element = $('#' + anchor_id);

          // do we have such element + is it a modal?  --> show it
          if (element.length && element.hasClass('modal')) {
            element.modal('show');
          }
        });

        // execute hashchange on first page load
        $(window).trigger('hashchange');

        // remove url fragment on modal hide
        $('.modal').on('hidden.bs.modal', function() {
          try {
            if (history && history.replaceState) {
                history.replaceState({}, '', '#');
            }
          } catch(e) {}
        });
      document.body.innerHTML = document.body.innerHTML.replace(
          /##HOST##/g,
          getHost());
      });
  </script><style>
  .hljs {
    background: transparent;
  }
  .parent {
    color: #FFFFF;
  }
  .list-group-item > .badge {
    float: none;
    margin-right: 6px;
  }
  .panel-title > .methods {
    float: right;
  }
  .badge {
    border-radius: 0;
    text-transform: uppercase;
    width: 70px;
    font-weight: normal;
    color: #f3f3f6;
    line-height: normal;
  }
  .badge_get {
    background-color: #63a8e2;
  }
  .badge_post {
    background-color: #6cbd7d;
  }
  .badge_put {
    background-color: #22bac4;
  }
  .badge_delete {
    background-color: #d26460;
  }
  .list-group, .panel-group {
    margin-bottom: 0;
  }
  .panel-group .panel+.panel-white {
    margin-top: 0;
  }
  .panel-group .panel-white {
    border-bottom: 1px solid #F5F5F5;
    border-radius: 0;
  }
  .panel-white:last-child {
    border-bottom-color: white;
    -webkit-box-shadow: none;
    box-shadow: none;
  }
  .panel-white .panel-heading {
    background: white;
  }
  .tab-pane ul {
    padding-left: 2em;
  }
  .tab-pane h2 {
    font-size: 1.2em;
    padding-bottom: 4px;
    border-bottom: 1px solid #ddd;
  }
  .tab-pane h3 {
    font-size: 1.1em;
  }
  .tab-content {
    border-left: 1px solid #ddd;
    border-right: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
    padding: 10px;
  }
  #sidebar {
    margin-top: 30px;
  }
  .top-resource-description {
    border-bottom: 1px solid #ddd;
    background: #fcfcfc;
    padding: 15px 15px 0 15px;
    margin: -15px -15px 10px -15px;
  }
  .resource-description {
    border-bottom: 1px solid #fcfcfc;
    background: #fcfcfc;
    padding: 15px 15px 0 15px;
    margin: -15px -15px 10px -15px;
  }
  .list-group .badge {
    float: left;
  }
  .method_description {
    margin-left: 85px;
  }
  .method_description p:last-child {
    margin: 0;
  }
  .list-group-item {
    cursor: pointer;
  }
  .list-group-item:hover {
    background-color: #FFFFF;
  }
  .navbar-inverse {
    background-color: #305590;
    border-color: #305590;
  }
  .navbar-inverse .navbar-nav>li>a {
    color: #f5f5f5;
  }
  .navbar-inverse .navbar-brand {
    color: #f5f5f5;
  }
  .nav-pills>li.active>a, .nav-pills>li.active>a:hover, .nav-pills>li.active>a:focus {
    color: #fff;
    background-color: #305590;
  }
  a {
    color: #305590;
  }
  h1, .h1 {
    color: #ec9900;
  }
  h3, .h3 {
    font-size: 26px;
    margin-bottom: 20px;
  }
  body { margin-top: 60px; }
  h3:before {
    display: block;
    content: " ";
    margin-top: -60px;
    height: 60px;
    visibility: hidden;
  }
  code {
    color: #ce7603;
  }
  h4, .h4, h5, .h5, h6, .h6 {
    margin-top: 20px;
    margin-bottom: 10px;
  }
  </style></head><body data-spy="scroll" data-target="#sidebar"><nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="container"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="index.html"><img src="img/rti_logo.png" style="vertical-align:bottom" alt="Real-Time Innovations"> <span>&nbsp;&nbsp;RTI Perftest</span></a><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"><ul class="nav navbar-nav navbar-right"><li><a href="https://github.com/rticommunity/rtiperftest">GitHub</a></li><li><a href="download.html">Download</a></li><li><a href="compilation.html">Compilation</a></li><li><a href="command_line_parameters.html">Parameters</a></li><li><a href="examples.html">Examples</a></li><li><a href="release_notes.html">Release Notes</a></li></ul></div></div></nav><div class="container"><div class="row"><div class="col-md-9" role="main"><div class="page-header"><h1>RTI Perftest 5.2.5</h1></div><div class="page-header"><h3 id="1-Testing-Performance"><a href="#1-Testing-Performance">1 Testing Performance</a></h3><p>This document describes how to run a combined latency and throughput test application for <em>RTI Connext DDS</em>.</p><p>The test measures what is sometimes called loaded latency -- latency at a given throughput level. It can help you answer questions such as:</p><ul><li><p>For a given publishing configuration (e.g., queue size, batching settings), sample size, and subscribing configuration (e.g., queue size, Listener vs. WaitSet) what is the throughput of my network?</p></li><li><p>When my network is heavily loaded, what latency can I expect?</p></li><li><p>For a given configuration, what is the best-case latency with no other traffic on the network?</p></li></ul><p>For examples of specific configurations, see See Example Command Lines for Running the Performance Test.</p><p>This performance test is implemented in C++ (Traditional and Modern APIs), C# and Java.</p><p><strong>Note:</strong> All references in this document to “C++” refer to both the Traditional and Modern C++ APIs unless otherwise noted.</p></div><div class="page-header"><h3 id="2-Supported-Platforms"><a href="#2-Supported-Platforms">2 Supported Platforms</a></h3><p><em>RTI Perftest</em> makes use of the <em>RTI Connext DDS</em> <em>Rtiddsgen</em> tool in order to generate part of its code and also the makefile/project files used to compile that code.</p><p><em>RTI Perftest</em> scripts works for every platform for which <em>Rtiddsgen</em> can generate an example, except for those in which <em>Rtiddsgen</em> doesn&#39;t generate regular makefiles or <em>Visual Studio Solutions</em> but specific project files. That is the case of <em>Android</em> platorms as well as the <em>iOS</em> ones.</p><p>Certain platforms will compile with the out of-the-box code and configurations, but further tuning could be needed in order to make the application run in the specific platform. The reason is usually the memory consumption of the application or the lack of support of the platform for certain features (like a file system).</p><p>If you need help with the compilation or execution process, contact support@rti.com.</p></div><div class="page-header"><h3 id="3-Release-Notes"><a href="#3-Release-Notes">3 Release Notes</a></h3><h3 id="rti-perftest-5-2-5-compatibility">RTI Perftest 5.2.5 Compatibility</h3><p><em>RTI Perftest</em> 5.2.5 is designed to compile and work against the <em>RTI Connext DDS</em> 5.2.5 release.</p><p>In addition, it is also compatible with <em>RTI Connext DDS</em> 5.2.3 and 5.2.4 releases. However, since the build scripts make use of certain specific parameters in <em>Rtiddsgen</em> the <code>--secure</code> and <code>--openssl-home</code> parameters will not work.</p><h3 id="what-s-new-in-5-2-5">What&#39;s New in 5.2.5</h3><h4 id="platform-support-and-build-system">Platform support and build system</h4><p><em>RTI Perftest 5.2.5</em> makes use of the <em>RTI Connext DDS</em> <em>Rtiddsgen</em> tool in order to generate part of its code and also the makefile/project files used to compile that code.</p><p>Therefore, all the already generated makefiles and <em>Visual Studio</em> solutions have been removed and now the build system depends on 2 scripts: <code>build.sh</code> for Unix-based systems and <code>build.bat</code> for Windows systems.</p><p><em>RTI Perftest</em> scripts works for every platform for which <em>Rtiddsgen</em> can generate an example, except for those in which <em>Rtiddsgen</em> doesn&#39;t generate regular makefiles or <em>Visual Studio Solutions</em> but specific project files. That is the case of <em>Android</em> platforms as well as the <em>iOS</em> ones.</p><p>Certain platforms will compile with the out of-the-box code and configurations, but further tuning could be needed in order to make the application run in the specific platform. The reason is usually the memory consumption of the application or the lack of support of the platform for certain features (like a file system).</p><h4 id="improved-directory-structure">Improved directory structure</h4><p><em>RTI Perftest 5.2.5</em> directory structure has been cleaned up, having now a much more compact and consistent schema.</p><h4 id="github">Github</h4><p><em>RTI Perftest</em> development has been moved to a <em>GitHub</em> project. This will allow more frequently updates and code contributions.</p><p>The URL of the project is the following: <a href="github.com/rticommunity/rtiperftest">github.com/rticommunity/rtiperftest</a>.</p><h4 id="documentation">Documentation</h4><p>Documentation is no longer provided as a PDF document, but as <em>markdown</em> files as well as in <em>html</em> format. You will be able to access to the documentation from the <em>RTI Community</em> page, as well as from the <em>GitHub</em> project.</p><h4 id="support-for-udpv6">Support for UDPv6</h4><p>Added command line parameter to force communication via UDPv6. By specifying <code>-enableUdpv6</code> you will only communicate data by using the UDPv6 transport.</p><p>The use of this feature will imply setting the <code>NDDS_DISCOVERY_PEERS</code> environment variable to (at least) one valid IPv6 address.</p><h4 id="support-for-dynamic-data">Support for Dynamic data</h4><p>Added command line parameter to specify the use of the Dynamic Data API instead of the regular <em>Rtiddsgen</em> generated code use.</p><h4 id="simplified-execution-in-vxworks-kernel-mode">Simplified execution in VxWorks kernel mode</h4><p>The execution in <em>VxWorks OS kernel mode</em> has been simplified for the user. Now the user can make use of <code>subscriber_main()</code> and <code>publisher_main()</code> and modify its content with all the parameters required for the tests.</p><h4 id="decreased-memory-requirements-for-latency-performance-test">Decreased Memory Requirements for Latency Performance Test</h4><p>The default number of iterations (samples sent by the performance test publisher side) when performing a latency test has been updated. Before, the default value was <code>100,000,000</code>. This value was used to internally allocate certain buffers, which imposed large memory requirements. The new value is <code>10,000,000</code> (10 times less).</p><h3 id="what-s-fixed-in-5-2-5">What&#39;s Fixed in 5.2.5</h3><h4 id="rti-perftest-behavior-when-using-multiple-publishers">RTI Perftest behavior when using multiple publishers</h4><p>The previous behavior specified that an <em>RTI Perftest Subscriber</em> in a scenario with multiple <em>RTI Perftest Publishers</em> would stop receiving samples and exit after receiving the last sample from the <em>RTI Perftest</em> Publisher with <code>pid=0</code>. This behavior could lead into an hang state if some <em>RTI Perftest Publishers</em> with different <code>pid</code> were still missing to send new samples.</p><p>The new behavior makes the <em>RTI Perftest Subscriber</em> wait until all the Perftest Publishers finish sending all their samples and then exit.</p><h4 id="possible-std-bad_alloc-and-segmentation-fault-in-latency-test-in-case-of-insufficient-memory">Possible <code>std::bad_alloc</code> and Segmentation Fault in Latency Test in case of insufficient memory</h4><p>When performing a latency performance test with traditional or modern C++, the test tries to allocate certain arrays of unsigned longs. These arrays can be quite large. On certain embedded platforms, due to memory limitations, this caused a <code>std::bad_alloc</code> error that was not properly captured, and a segmentation fault. This problem has been resolved. Now the performance test will inform you of the memory allocation issue and exit properly.</p><h4 id="default-max-number-of-instances-on-subscriber-side-changed-to-dds_length_unlimited-">Default Max Number of Instances on Subscriber Side Changed to <code>DDS_LENGTH_UNLIMITED</code></h4><p>In the previous release, if you did not set the maximum number of instances on the subscriber side, it would default to one instance. Therefore the samples for all instances except the first one were lost.</p><p>The new default maximum number of instances on the subscriber side has been changed from one to <code>DDS_LENGTH_UNLIMITED</code>. You can change this limit manually by setting the parameter <code>-instances &lt;number&gt;</code>.</p><h4 id="error-when-using-shared-memory-and-large-samples">Error when using Shared Memory and Large Samples</h4><p>When using <em>RTI Perftest</em> with large samples and enabling shared memory we could get into the following error:</p><pre><code>Large data settings enabled (-dataLen &gt; 63000).
[D0001|ENABLE]NDDS_Transport_Shmem_Property_verify:received_message_count_max &lt; 1
[D0001|ENABLE]NDDS_Transport_Shmem_newI:Invalid transport properties.
</code></pre><h3 id="known-issues">Known Issues</h3><h4 id="rti-perftest-5-2-5-version-compatibility">RTI Perftest 5.2.5 version compatibility</h4><p><em>RTI Perftest 5.2.5</em> build system makes use of specific features from <em>RTI Connext DDS 5.2.5 Code Generator (rtiddsgen)</em> in order to generate the makefile/project files used to compile. This implies the break of compatibility with previous <em>RTI Connext DDS</em> releases.</p><h4 id="compiling-manually-on-windows-when-using-the-rti-security-plugin">Compiling manually on Windows when using the <em>RTI Security</em> plugin</h4><p><em>rtiddsgen</em> generated solutions for Windows allow 4 different configurations:</p><ul><li>Debug</li><li>Debug DLL</li><li>Release</li><li>Release DLL</li></ul><p>However, <em>RTI Perftest 5.2.5</em> new build system is focused to only compile one of those modes at a time when using the <code>-secure</code> option. You can still select which one will be used by using the <code>-debug</code> and <code>-dynamic</code> flags.</p></div><div class="page-header"><h3 id="4-Overview"><a href="#4-Overview">4 Overview</a></h3><p>The publishing side of the test writes data as fast as it can. Every few samples (configured through the command line), it sends a special sample requesting an echo from the subscribing side. It uses this <code>request -&gt; echo</code> exchange to measure round-trip latency.</p><p><img src="img/PerfTest_Overview_Diagram.png" alt="PerfTest Overview Diagram"></p><p>As you will see in Section 8, there are several command-line options, including ones to designate whether the application will act as the publisher or subscriber.</p><p>You will start multiple copies of the application (typically 1 publisher and 1 or more subscribers):</p><ul><li>The publishing application publishes throughput data; it also subscribes to the latency echoes.</li><li>The subscribing applications subscribe to the throughput data, in which the echo requests are embedded; they also publish the latency echoes.</li></ul><p>The publisher prints the latency test results meanwhile the subscriber prints the throughput results.</p></div><div class="page-header"><h3 id="5-Download-Instructions"><a href="#5-Download-Instructions">5 Download Instructions</a></h3><p><em>RTI Perftest</em> bundle is provided in 3 different ways:</p><ul><li><p>You can clone it from the official <em>Github</em> repository:</p><p><code>git clone -b 5.2.5 https://github.com/rticommunity/rtiperftest.git</code></p><p>This command will download the <em>Github</em> repository and create a folder named <code>rti_perftest</code>.</p></li><li><p>You can download a zip file containing the <em>RTI Perftest</em> files from the <em>RTI Perftest</em> <em>Github</em> page: <a href="https://github.com/rticommunity/rtiperftest">github.com/rticommunity/rtiperftest</a>. Once the zip file is downloaded you will need to extract its content, this will create a folder named <code>rti_perftest</code>.</p></li><li><p>You can download the zip bundle from <em>RTI Community Forum</em>, <a href="http://community.rti.com/">http://community.rti.com</a>. Search for <code>Performance Test</code>. Once the zip file is downloaded you will need to extract its content, this will create a folder named <code>rti_perftest</code>.</p></li></ul><p>If you need help with the download process, contact <a href="support@rti.com">support@rti.com</a>.</p></div><div class="page-header"><h3 id="6-Code-Generation-And-Compilation"><a href="#6-Code-Generation-And-Compilation">6 Code Generation And Compilation</a></h3><h3 id="unix-systems">Unix systems</h3><p>For Unix systems, <em>RTI Perftest</em> makes use of a script in the top level directory named <code>build.sh</code>.</p><p>The purpose of <code>build.sh</code> is to, in the first place, invoke <em>RTI DDS Generator</em> (<em>Rtiddsgen</em>) in order to generate the type-code files and makefiles needed to compile a target architecture. Then, in second place, execute the makefile with the right arguments to generate the executables.</p><p>This script supports the code generation and compilation for <em>Traditional C++</em>, <em>Modern C++</em> and <em>Java</em>.</p><p>Potentially, <code>build.sh</code> can generate and compile code for every architecture supported by <em>Rtiddsgen</em> where a makefile is generated as output when the <code>-example</code> command line is specified.</p><h4 id="prerequisites">Prerequisites</h4><ul><li><p><em>RTI Connext DDS</em> should be installed in the system where the <code>build.sh</code> script is going to run. The <em>Target</em> libraries for the platform to be generated should also be installed.</p></li><li><p>The <code>$NDDSHOME</code> environment variable should be set correctly. Alternatively, <code>$NDDSHOME</code> can be passed directly to the <code>build.sh</code> script by using the <code>--nddshome &lt;PATH&gt;</code> command line option.</p></li><li><p>The <code>build.sh</code> script is written in <code>bash</code>. It is going to try to execute it from <code>/bin/bash</code>.</p></li><li><p><code>GNU make</code> is required to be accessible from the <code>$PATH</code> environment variable in order to execute the <code>makefiles</code> generated by <em>Rtiddsgen</em>. Alternatively the <code>GNU make</code> executable can be passed directly to the <code>build.sh</code> script by using the <code>--make &lt;PATH&gt;</code> command line option.</p></li><li><p>The C++ Compiler/Linker parent folders should be in the <code>$PATH</code> variable. The names of the compiler and linker are going to be determined by the makefile generated by <em>Rtiddsgen</em>. The C++ Compiler and Linker are not required if the script is set to avoid the C++ compilation by adding the <code>--skip-cpp-build</code> and <code>--skip-cpp03-build</code> command line options.</p></li><li><p>Java JDK should be available in the system and accessible from the <code>$PATH</code> environment. This is not required if the script is set to avoid the Java ByteCode generation by adding the <code>--skip-java-build</code> command line option.</p></li><li><p>If you intend to compile and test using the <em>RTI Secure Plugin</em> you will need to link against the OpenSSL libraries for your architecture.</p></li></ul><h4 id="parameters">Parameters</h4><p>The <code>build.sh</code> script accepts the following list of parameters:</p><table class="table"><thead><tr><th style="text-align:right">Parameter</th><th style="text-align:center">Required</th><th>Description</th></tr></thead><tbody><tr><td style="text-align:right">--platform</td><td style="text-align:center">Required</td><td>Architecture/Platform for which build.sh is going to compile <em>RTI Perftest</em>.</td></tr><tr><td style="text-align:right">--nddshome</td><td style="text-align:center">Optional</td><td>Path to the <em>RTI Connext DDS installation</em>. If this parameter is not present, the <code>$NDDSHOME</code> variable should be.</td></tr><tr><td style="text-align:right">--skip-java-build</td><td style="text-align:center">Optional</td><td>Avoid <code>Java ByteCode</code> generation and <code>.jar</code> creation.</td></tr><tr><td style="text-align:right">--skip-cpp-build</td><td style="text-align:center">Optional</td><td>Avoid C++ code generation and compilation.</td></tr><tr><td style="text-align:right">--skip-cpp03-build</td><td style="text-align:center">Optional</td><td>Avoid C++ New PSM code generation and compilation.</td></tr><tr><td style="text-align:right">--dynamic</td><td style="text-align:center">Optional</td><td>Compile using the RTI Connext DDS dynamic libraries. Default: Static Libraries.</td></tr><tr><td style="text-align:right">--debug</td><td style="text-align:center">Optional</td><td>Compile using the RTI Connext DDS debug libraries. Default: Release Libraries.</td></tr><tr><td style="text-align:right">--secure</td><td style="text-align:center">Optional</td><td>Enable the compilation of the Perfest code specific for security and adds the RTI Connext DDS Security Libraries in the linking step (if compiling statically). Default: Not set.</td></tr><tr><td style="text-align:right">--openssl-home</td><td style="text-align:center">Optional</td><td>Path to the openSSL home directory. Needed when compiling using the --secure option and statically.</td></tr><tr><td style="text-align:right">--make</td><td style="text-align:center">Optional</td><td>Path to the <code>GNU make</code> executable. If this parameter is not present, <code>GNU make</code> variable should be available from your <code>$PATH</code> variable.</td></tr><tr><td style="text-align:right">--java-home</td><td style="text-align:center">Optional</td><td>Path to the Java <code>JDK</code> home folder. If this parameter is not present, <code>javac</code>, <code>jar</code> and <code>java</code> executables should be available from your <code>$PATH</code> variable.</td></tr><tr><td style="text-align:right">--clean</td><td style="text-align:center">Optional</td><td>If this option is present, the <code>build.sh</code> script will clean all the generated code and binaries from previous executions.</td></tr><tr><td style="text-align:right">--help -h</td><td style="text-align:center">Optional</td><td>If this option is present, the <code>build.sh</code> script will display a help description and exit.</td></tr></tbody></table><h4 id="examples-running-build-script">Examples Running build script</h4><p>In order to build using <code>build.sh</code> you just need to invoke the script with the command line parameters desired. The following are some typical examples:</p><ul><li><p>Generation and compilation for a given architecture (<code>x64Darwin15clang7.0</code>) for C++ (Classic and new) and Java .</p><pre><code>  ./build.sh --platform x64Darwin15clang7.0
</code></pre></li><li><p>Generation and compilation for a given architecture (<code>x64Darwin15clang7.0</code>) just for C++ (Classic and new).</p><pre><code>  ./build.sh --platform x64Darwin15clang7.0 --skip-java-build
</code></pre></li><li><p>Generation and compilation for a given architecture (<code>x64Darwin15clang7.0</code>) for all supported languages and linking against the Dynamic + Debug libraries.</p><pre><code>  ./build.sh --platform x64Darwin15clang7.0 --dynamic --debug
</code></pre></li><li><p>Generation and compilation for a given architecture (<code>x64Darwin15clang7.0</code>) for all supported languages, enabling the security options and linking statically (default).</p><pre><code>  ./build.sh --platform x64Darwin15clang7.0 --secure --openssl-home &lt;PATH&gt;
</code></pre></li><li><p>Generation and compilation for a given architecture (<code>x64Darwin15clang7.0</code>) for all supported languages, enabling the security options and linking dynamically. As you can see in this case there is no need to specify the <code>--openssl-home</code> command line argument.</p><pre><code>  ./build.sh --platform x64Darwin15clang7.0 --secure --dynamic
</code></pre></li><li><p><em>RTI Perftest</em> directory clean-up.</p><pre><code>  ./build.sh --clean
</code></pre></li></ul><h3 id="windows-systems">Windows systems</h3><p>For Windows systems, <em>RTI Perftest</em> makes use of a script in the top level directory named <code>build.bat</code>. Its content is equivalent to the <code>build.sh</code> described before.</p><p>The purpose of <code>build.bat</code> is to invoke <em>RTI DDS Generator</em> (<em>Rtiddsgen</em>) in order to generate the type-code files and <em>Visual Studio</em> solution needed to compile a target architecture. Then execute the <em>Visual Studio</em> solution with the right arguments to generate the executables.</p><p>This script supports the code generation and compilation for <em>Traditional C++</em>, <em>Modern C++</em>, <em>C#</em> and <em>Java</em>.</p><p>The <code>build.bat</code> script should be able to generate and compile code for every <em>Windows</em> architecture supported by <em>Rtiddsgen</em> when the <code>-example</code> command line is specified.</p><h4 id="prerequisites">Prerequisites</h4><ul><li><p><em>RTI Connext DDS</em> should be installed in the system where the <code>build.bat</code> script is going to run. The <em>Target</em> libraries for the platform to be generated should also be installed.</p></li><li><p>The <code>%NDDSHOME%</code> environment variable should be set correctly. Alternatively, <code>%NDDSHOME%</code> can be passed directly to the <code>build.bat</code> script by using the <code>--nddshome &lt;PATH&gt;</code> command line option.</p></li><li><p>The <em>Microsoft Visual Studio</em> for the architecture intended to be built should be installed in your system. The <code>msbuild.exe</code> program should be available in the <code>%PATH%</code> variable. <em>[See note-1]</em></p></li><li><p>Java JDK should be available in the system and accessible from the <code>%PATH%</code> environment. This is not required if the script is set to avoid the Java ByteCode generation by adding the <code>--skip-java-build</code> command line option.</p></li><li><p>If you intend to compile and test using the <em>RTI Secure Plugin</em> you will need to link against the OpenSSL libraries for your architecture.</p></li></ul><p><em>[note-1]:</em> The simplest way to run the <code>build.bat</code> script and ensure that all the <em>Microsoft Visual Studio</em> variables are correctly set is by running it from the <code>Visual Studio Command Prompt</code> provided by each of the <em>Microsoft Visual Studio</em> versions.</p><h4 id="parameters">Parameters</h4><p>The <code>build.bat</code> script accepts the following list of parameters:</p><table class="table"><thead><tr><th style="text-align:right">Parameter</th><th style="text-align:center">Required</th><th>Description</th></tr></thead><tbody><tr><td style="text-align:right">--platform</td><td style="text-align:center">Required</td><td>Architecture/Platform for which build.bat is going to compile <em>RTI Perftest</em>.</td></tr><tr><td style="text-align:right">--nddshome</td><td style="text-align:center">Optional</td><td>Path to the <em>RTI Connext DDS installation</em>. If this parameter is not present, the <code>%NDDSHOME%</code> variable should be.</td></tr><tr><td style="text-align:right">--skip-java-build</td><td style="text-align:center">Optional</td><td>Avoid <code>Java ByteCode</code> generation and <code>.jar</code> creation.</td></tr><tr><td style="text-align:right">--skip-cpp-build</td><td style="text-align:center">Optional</td><td>Avoid C++ code generation and compilation.</td></tr><tr><td style="text-align:right">--skip-cpp03-build</td><td style="text-align:center">Optional</td><td>Avoid C++ New PSM code generation and compilation.</td></tr><tr><td style="text-align:right">--skip-cs-build</td><td style="text-align:center">Optional</td><td>Avoid C# code generation and compilation.</td></tr><tr><td style="text-align:right">--dynamic</td><td style="text-align:center">Optional</td><td>Compile using the RTI Connext DDS dynamic libraries. Default: Static Libraries.</td></tr><tr><td style="text-align:right">--debug</td><td style="text-align:center">Optional</td><td>Compile using the RTI Connext DDS debug libraries. Default: Release Libraries.</td></tr><tr><td style="text-align:right">--secure</td><td style="text-align:center">Optional</td><td>Enable the compilation of the Perfest code specific for security and adds the RTI Connext DDS Security Libraries in the linking step (if compiling statically). Default: Not set.</td></tr><tr><td style="text-align:right">--openssl-home</td><td style="text-align:center">Optional</td><td>Path to the openSSL home directory. Needed when compiling using the --secure option and statically.</td></tr><tr><td style="text-align:right">--msbuild</td><td style="text-align:center">Optional</td><td>Path to the <code>msbuild.exe</code> executable. If this parameter is not present, <code>msbuild</code> variable should be available from your <code>%PATH%</code> variable.</td></tr><tr><td style="text-align:right">--java-home</td><td style="text-align:center">Optional</td><td>Path to the Java <code>JDK</code> home folder. If this parameter is not present, <code>javac</code>, <code>jar</code> and <code>java</code> executables should be available from your <code>%PATH%</code> variable.</td></tr><tr><td style="text-align:right">--clean</td><td style="text-align:center">Optional</td><td>If this option is present, the <code>build.bat</code> script will clean all the generated code and binaries from previous executions.</td></tr><tr><td style="text-align:right">--help -h</td><td style="text-align:center">Optional</td><td>If this option is present, the <code>build.bat</code> script will display a help description and exit.</td></tr></tbody></table><h4 id="examples-running-build-script">Examples Running build script</h4><p>In order to build using <code>build.bat</code> you just need to invoke the script with the command line parameters desired. The following are some typical examples:</p><ul><li><p>Simple generation and compilation for a given architecture (<code>x64Win64VS2012</code>) for C++ (Classic and new) C# and Java.</p><pre><code>  build.bat --platform x64Win64VS2012
</code></pre></li><li><p>Simple generation and compilation for a given architecture (<code>x64Win64VS2012</code>) just for C#.</p><pre><code>  build.bat --platform x64Win64VS2012 --skip-java-build --skip-cpp-build --skip-cpp03-build
</code></pre></li><li><p>Generation and compilation for a given architecture (<code>x64Win64VS2012</code>) for all supported languages and linking against the Dynamic + Debug libraries.</p><pre><code>  ./build.sh --platform x64Win64VS2012 --dynamic --debug
</code></pre></li><li><p>Generation and compilation for a given architecture (<code>x64Win64VS2012</code>) for all supported languages, enabling the security options and linking statically (default).</p><pre><code>  ./build.sh --platform x64Win64VS2012 --secure --openssl-home &lt;PATH&gt;
</code></pre></li><li><p>Generation and compilation for a given architecture (<code>x64Win64VS2012</code>) for all supported languages, enabling the security options and linking dynamically. As you can see in this case there is no need to specify the <code>--openssl-home</code> command line argument.</p><pre><code>  ./build.sh --platform x64Win64VS2012 --secure --dynamic
</code></pre></li><li><p><em>RTI Perftest</em> directory clean-up.</p><pre><code>  build.bat --clean
</code></pre></li></ul></div><div class="page-header"><h3 id="7-Modify-RTI-Perftest-for-Larger-Samples"><a href="#7-Modify-RTI-Perftest-for-Larger-Samples">7 Modify RTI Perftest for Larger Samples</a></h3><p>By default <em>RTI Perftest</em> can send samples up to 128 KB, in order to test for larger samples the following changes are needed:</p><h3 id="changes-in-the-idl-">Changes in the idl:</h3><p>Change the content of the <code>srcIdl/perftest.idl</code> source file so the maximum size of the sequence containing the data fits your desired size:</p><pre><code class="lang-c">    const long MAX_BINDATA_SIZE = &lt;NEW_SIZE&gt;;
</code></pre><h3 id="changes-in-the-resource-limits-in-the-qos-profile">Changes in the resource limits in the QoS profile</h3><p><em>RTI Perftest</em> is designed to allocate a big amount of samples in the reader queues, this helps increasing the performance when working with small sample sizes.</p><p>However, since you are increasing the size of the samples, now you could get into a position where the <em>RTI Connext DDS</em> libraries try and fail to allocate so much memory in the reader side.</p><p>This scenario is resolved by modifying the QoS profiles used by the <em>RTI Perftest</em> application. In order to do so, you will need to modify the following QoS profile in the <code>perftest_qos_profiles.xml</code> file:</p><pre><code class="lang-xml">&lt;qos_profile name="ThroughputQos" base_name="BaseProfileQos"&gt;
  &lt;datareader_qos&gt;
    &lt;resource_limits&gt;
      &lt;max_samples&gt;10000&lt;/max_samples&gt;
      &lt;initial_samples&gt;5000&lt;/initial_samples&gt;
      &lt;max_samples_per_instance&gt;10000&lt;/max_samples_per_instance&gt;
    &lt;/resource_limits&gt;

    &lt;reader_resource_limits&gt;
      &lt;max_samples_per_remote_writer&gt;10000&lt;/max_samples_per_remote_writer&gt;
    &lt;/reader_resource_limits&gt;
  &lt;/datareader_qos&gt;
&lt;/qos_profile&gt;
</code></pre><p>The exact values needed will depend on your specific sample size and the machine available resources. A good idea would be trying decreasing the existing sizes by a x100 factor.</p><h3 id="changes-in-code">Changes in code</h3><p><em>RTI Perftest</em> performs some internal checkings to ensure that the sample size specified by command-line parameter is lower than the maximum allowed. Therefore some changes are required:</p><h4 id="changes-in-c-">Changes in C++</h4><p>Modify the following line in the <code>srcCpp/MessagingIF.h</code> source file:</p><pre><code class="lang-c++">    static const int MAX_DATA_SIZE = &lt;NEW_SIZE&gt;;
</code></pre><h4 id="changes-in-c-03">Changes in C++03</h4><p>Modify the following line in the <code>srcCpp03/MessagingIF.h</code> source file:</p><pre><code class="lang-c++">    static const int MAX_DATA_SIZE = &lt;NEW_SIZE&gt;;
</code></pre><h4 id="changes-in-java">Changes in Java</h4><p>Modify the following line in the <code>srcJava/com/rti/perftest/TestMessage.java</code> source file:</p><pre><code class="lang-java">    public static final int MAX_DATA_SIZE = &lt;NEW_SIZE&gt;;
</code></pre><h4 id="changes-in-c-">Changes in C#</h4><p>Modify the following line in the <code>srcCs/MessagingIF.cs</code> source file:</p><pre><code class="lang-csharp">    public const int MAX_DATA_SIZE = &lt;NEW_SIZE&gt;;
</code></pre><h3 id="changes-in-the-flow-controller">Changes in the Flow Controller</h3><p><em>RTI Perftest</em> will detect that the sample size is bigger than 63000 bytes, so it will set the DataWriters to do Asynchronous writing. This will imply the use of the Flow Controller defined in the <code>perftest_qos_profiles.xml</code> configuration file.</p><pre><code class="lang-xml">&lt;qos_profile name="BaseProfileQos"&gt;
  &lt;participant_qos&gt;
    &lt;property&gt;
      &lt;value&gt;
        &lt;element&gt;
          &lt;name&gt;dds.flow_controller.token_bucket.fast_flow.token_bucket.max_tokens&lt;/name&gt;
          &lt;value&gt;30&lt;/value&gt;
        &lt;/element&gt;
        &lt;element&gt;
          &lt;name&gt;dds.flow_controller.token_bucket.fast_flow.token_bucket.tokens_added_per_period&lt;/name&gt;
          &lt;value&gt;20&lt;/value&gt;
        &lt;/element&gt;
        &lt;element&gt;
          &lt;name&gt;dds.flow_controller.token_bucket.fast_flow.token_bucket.bytes_per_token&lt;/name&gt;
          &lt;value&gt;65536&lt;/value&gt;
        &lt;/element&gt;
        &lt;element&gt;
          &lt;name&gt;dds.flow_controller.token_bucket.fast_flow.token_bucket.period.sec&lt;/name&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/element&gt;
        &lt;element&gt;
          &lt;name&gt;dds.flow_controller.token_bucket.fast_flow.token_bucket.period.nanosec&lt;/name&gt;
          &lt;value&gt;10000000&lt;/value&gt;
        &lt;/element&gt;
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/participant_qos&gt;
&lt;/qos_profile&gt;
</code></pre><p>Depending on your sample size, you may need to do further tuning to the Flow Controller values.</p></div><div class="page-header"><h3 id="8-Test-execution"><a href="#8-Test-execution">8 Test execution</a></h3><p>The test is provided in C++ (Modern and Traditional APIs), C#, and Java. The list below identifies how to run the executables, once you have built them, and how to pass configuration parameters to them. For detailed descriptions of the test parameters, see See <em>Test Parameters Section</em>. For example test configurations, see the <em>Example Command Lines</em> section.</p><p>When running the test, keep in mind that a throughput test will necessarily place a heavy load on your network and potentially on your CPU(s) as well. For the most accurate results, and the fewest complaints from your coworkers and IT department, run the test when and where you have a subnet to yourself. The test is designed to measure latency under loaded network conditions; it will produce those loads itself: There is no need to produce them externally (and your throughput results may not be meaningful if you do).</p><h3 id="c-and-c-executables">C++ and C# executables</h3><p>The C++ and C# executables are in these directories:</p><pre><code>&lt;installation directory&gt;/bin/&lt;architecture&gt;/Release
&lt;installation directory&gt;/bin/&lt;architecture&gt;/Debug
</code></pre><p>Where <code>&lt;architecture&gt;</code> depends on your architecture, such as <code>i86Linux3gcc4.8.2</code> or <code>i86Win32VS2012</code>.</p><p>You can differentiate the executables for the two C++ implementations (Traditional and Modern) by the name: the Traditional C++ API implementation uses <code>perftest_cpp</code> and the Modern C++ API implementation is named <code>perftest_cpp03</code>.</p><p>The test uses an XML configuration file and locates this file based on paths relative to the directory from which the test is run. Therefore, to use this configuration file without the need of adding extra command line parameters:</p><p>Traditional C++:</p><pre><code>bin/&lt;architecture&gt;/Release/perftest_cpp &lt;-pub|-sub&gt; [parameters] or
bin/&lt;architecture&gt;/Debug/perftest_cpp &lt;-pub|-sub&gt; [parameters]
</code></pre><p>Modern C++:</p><pre><code>bin/&lt;architecture&gt;/Release/perftest_cpp03 &lt;-pub|-sub&gt; [parameters] or
bin/&lt;architecture&gt;/Debug/perftest_cpp03 &lt;-pub|-sub&gt; [parameters]
</code></pre><h4 id="when-using-dynamic-linking">When using dynamic linking</h4><p>If you compiled the performance test executable dynamically add the <code>$NDDSHOME/lib/&lt;architecture&gt;</code> folder to:</p><ul><li>The <code>$LD_LIBRARY_PATH</code> variable if you are on Linux systems.</li><li>The <code>$DYLD_LIBRARY_PATH</code> variable if you are on OSX.</li><li>The <code>%PATH%</code> variable (if you are on Windows).</li></ul><h4 id="when-using-rti-secure-dds-plugin-and-using-dynamic-linking">When using <em>RTI Secure DDS Plugin</em> and using dynamic linking</h4><p>In such case, add the <em>OpenSSL</em> libraries in <code>$OPENSSLHOME/&lt;debug or release&gt;/lib</code> to the <code>$LD_LIBRARY_PATH</code>, <code>$DYLD_LIBRARY_PATH</code> or <code>%PATH%</code> variable:</p><ul><li>On Linux systems, add <code>$OPENSSLHOME/&lt;debug or release&gt;/lib</code> to <code>$LD_LIBRARY_PATH</code></li><li>On OSX systems, add <code>$OPENSSLHOME/&lt;debug or release&gt;/lib</code> to <code>$DYLD_LIBRARY_PATH</code></li><li>On Windows systems, add <code>%OPENSSLHOME$/&lt;debug or release&gt;/bin</code> to <code>%PATH%</code></li></ul><h3 id="java-executable">Java executable</h3><p><em>RTI Perftest</em> provides a <em>.sh</em> script and a <em>.bat</em> script to run the Java <code>jar</code> file. Those scripts are located in:</p><ul><li><code>bin/&lt;debug or release&gt;/perftest_java.sh</code> for UNIX-based systems.</li><li><code>bin/&lt;debug or release&gt;/perftest_java.bat</code> for Windows systems.</li></ul><p>Since the linking in Java is dynamic, add the <code>$NDDSHOME/lib/&lt;architecture&gt;</code> folder to:</p><ul><li>The <code>$LD_LIBRARY_PATH</code> variable if you are on Linux systems.</li><li>The <code>$DYLD_LIBRARY_PATH</code> variable if you are on OSX.</li><li>The <code>%PATH%</code> variable (if you are on Windows).</li></ul><p>Alternatively, when using the <em>RTI Perftest</em> scripts, you can set the environment variable <code>$RTI_PERFTEST_ARCH</code> to your specific architecture and let the script set <code>$LD_LIBRARY_PATH</code> or <code>%PATH%</code> for you. You also need to set the <code>$NDDSHOME</code> environment variable.</p><p><strong>For example</strong>: If you are using a Windows 32-bit architecture:</p><pre><code>set RTI_PERFTEST_ARCH=i86Win32VS2010
</code></pre><p>If you are using a Windows 64-bit architecture:</p><pre><code>set RTI_PERFTEST_ARCH=x64Win64jdk
</code></pre><p>If you are using the Linux i86Linux3gcc4.8.2 architecture:</p><pre><code>export RTI_PERFTEST_ARCH=i86Linux3gcc4.8.2
</code></pre><p>Make sure <code>java</code> is in your path before running the java example run script.</p><h4 id="when-using-java-on-unix-based-systems-with-rti-secure-dds">When using Java on UNIX-based systems with RTI Secure DDS</h4><p>In such case, add the <em>OpenSSL</em> libraries in <code>$OPENSSLHOME/&lt;debug or release&gt;/lib</code> to the <code>$LD_LIBRARY_PATH</code> or <code>%PATH%</code> variable:</p><ul><li>On Linux systems, add <code>$OPENSSLHOME/&lt;debug or release&gt;/lib</code> to <code>$LD_LIBRARY_PATH</code></li><li>On OSX systems, add <code>$OPENSSLHOME/&lt;debug or release&gt;/lib</code> to <code>$DYLD_LIBRARY_PATH</code></li><li>On Windows systems, add <code>%OPENSSLHOME$/&lt;debug or release&gt;/bin</code> to <code>%PATH%</code></li></ul><h3 id="launching-the-application">Launching the application</h3><p>The test uses an XML configuration file. It locates this file based on its path relative to the directory from which the test is run. To use this configuration file move to <em>RTI Perftest</em> top-level location.</p><p>Start the test applications. You can start the publisher or subscribers first, the order does not matter. When selecting your optional parameters, choose parameters that allow the test to run for at least 15 seconds to get any kind of meaningful results. The longer it runs, the more accurate the results will be.</p><p>Ideally, you should run the test for at least 180 seconds.</p><h4 id="c-traditional-api">C++ Traditional API</h4><pre><code>bin/&lt;architecture&gt;/release/perftest_cpp &lt;-pub|-sub&gt; [parameters] or
bin/&lt;architecture&gt;/debug/perftest_cpp &lt;-pub|-sub&gt; [parameters]
</code></pre><h4 id="c-modern-api">C++ Modern API</h4><pre><code>bin/&lt;architecture&gt;/release/perftest_cpp03 &lt;-pub|-sub&gt; [parameters] or
bin/&lt;architecture&gt;/debug/perftest_cpp03 &lt;-pub|-sub&gt; [parameters]
</code></pre><h4 id="c-api">C# API</h4><pre><code>bin/&lt;architecture&gt;/release/perftest_cs &lt;-pub|-sub&gt; [parameters] or
bin/&lt;architecture&gt;/debug/perftest_cs &lt;-pub|-sub&gt; [parameters]
</code></pre><h4 id="java-api">Java API</h4><pre><code>bin/release/perftest_java &lt;-pub|-sub&gt; [parameters]
bin/debug/perftest_java &lt;-pub|-sub&gt; [parameters]
</code></pre><p>where <code>&lt;architecture&gt;</code> depends on your architecture, such as <code>x64Linux3gcc4.8.2</code> or <code>i86Win32VS2012</code>.</p><p>After the publisher recognizes that the specified number of subscribers (see the See <code>-numSubscribers &lt;count&gt;</code> option) are online and the subscriber recognizes that the specified number of publishers (see the See <code>-numPublishers &lt;count&gt;</code> option) are online, the test begins.</p></div><div class="page-header"><h3 id="9-Test-Parameters"><a href="#9-Test-Parameters">9 Test Parameters</a></h3><p>Several parameters are available; you can enter them on the command line. All parameters are optional and case-insensitive; partial matches are allowed (such as <code>-h</code> instead of <code>-help</code>).</p><p>Some parameters only make sense in the publishing or subscribing application. The parameters are presented in the following tables, based on whether they may be used in a publishing application, a subscribing application, or both:</p><ul><li>See <a href="#params-pub-sub">Test Parameters for Publishing and Subscribing Applications</a></li><li>See <a href="#params-pub">Test Parameters Only for Publishing Applications</a></li><li>See <a href="#params-sub">Test Parameters Only for Subscribing Applications</a></li><li>See <a href="#params-pub-sub-secure">Test Parameters to Control RTI Secure DDS Options</a></li></ul><p>As you will see in the tables, the <code>-pub</code> parameter specifies a publishing application and the <code>-sub</code> specifies a subscribing application. If you do not specify See <code>-pub</code> then <code>-sub</code> is assumed.</p><p>For additional information on setting the parameters, see sections:</p><ul><li><a href="#sleepVsSpin">Spinning vs. Sleeping</a></li><li><a href="#queueSize">Send-Queue Size and Queue-Full Behavior</a></li><li><a href="#iterationsVsLatencyCount">Number of Iterations vs. Latency Count</a></li><li><a href="#warmUp">Warming Up</a></li><li><a href="#WaitSetEventCount">WaitSet Event Count and Delay</a></li><li><a href="#lat">How to Measure Latency for a Given Throughput</a></li><li><a href="#AutoTuningTurboMode">Auto Tuning and Turbo Mode</a></li></ul><h3 id="test-parameters-for-publishing-and-subscribing-applications-a-id-params-pub-sub-a-">Test Parameters for Publishing and Subscribing Applications <a id="params-pub-sub"></a></h3><ul><li><p><code>-bestEffort</code></p><p>Use best-effort communication.</p><p><strong>Default:</strong> <code>false</code> (use reliable communication).</p><p>For an introduction to the RTI reliability model, see the Strict Reliability design pattern in the RTI Connext DDS Core Libraries Getting Started Guide. See also: Reliable Communications in the RTI Connext DDS Core Libraries User’s Manual.</p></li><li><p><code>-dataLen &lt;bytes&gt;</code></p><p>Length of payload in bytes for each send.</p><p><strong>Default:</strong> <code>100 bytes.</code><br><strong>Range:</strong> <code>28 - 63000 bytes</code></p><p>The lower limit is the number of "overhead" bytes in the message (i.e., the timestamp, sequence number, and other meta-data used by the test); the upper limit ensures that, when the overhead of the wire protocol is added, it doesn&#39;t overflow the UDP maximum datagram size of 64KB.</p><p>If See <code>-scan</code> is specified, this value is ignored.</p></li><li><p><code>-debug</code></p><p>Run in debug mode (generates more verbose logging messages, which are useful to RTI support personnel).</p><p><strong>Default:</strong> false</p></li><li><p><code>-dynamicData</code></p><p>Run using the Dynamic Data API functions instead of the <em>rtiddsgen</em> generated calls.</p><p><strong>Default:</strong> false</p></li><li><p><code>-durability &lt;0|1|2|3&gt;</code></p><p>Sets the Durability kind:</p><p><code>0</code> - <code>VOLATILE</code> (default)<br><code>1</code> - <code>TRANSIENT LOCAL</code><br><code>2</code> - <code>TRANSIENT</code><br><code>3</code> - <code>PERSISTENT</code></p><p>For an introduction to the RTI durability model, see the Historical Data design pattern in the RTI Connext DDS Core Libraries Getting Started Guide. See also: Mechanisms for Achieving Information Durability and Persistence, Chapter 12, in the RTI Connext DDS Core Libraries User’s Manual.</p></li><li><p><code>-domain &lt;ID&gt;</code></p><p>Domain ID.</p><p>The publisher and subscriber applications must use the same domain ID in order to communicate.</p><p><strong>Default:</strong> <code>1</code><br><strong>Range:</strong> <code>0 - 200</code></p><p>See Choosing a Domain ID and Creating Multiple Domains, Section 8.3.4, in the RTI Connext DDS Core Libraries User’s Manual.</p></li><li><p><code>-enableSharedMemory</code></p><p>Enable the shared memory transport.</p><p><strong>Default:</strong> shared memory transport is disabled</p></li><li><p><code>-enableTcpOnly</code></p><p>Disable all the other transports and use only TCP transport for communication.</p><p><strong>Default:</strong> TCP transport not enabled</p></li><li><p><code>-help</code></p><p>Print an informative message with all the available command-line parameters and exit.</p></li><li><p><code>-instanceHashBuckets &lt;n&gt;</code></p><p>Number of hash buckets for instances.</p><p><strong>Default:</strong> <code>-1</code> (means same as the number of instances)<br><strong>Range:</strong> <code>&gt; 0</code></p></li><li><p><code>-instances &lt;int&gt;</code></p><p>Set the number of instances to use in the test. The publishing and subscribing applications must specify the same number of instances.</p><p>This option only makes sense when testing a keyed data type; to do so, use See <code>-keyed</code>.</p><p><strong>Default:</strong> <code>1</code><br><strong>Range:</strong> <code>&gt; 0</code></p></li><li><p><code>-keepDurationUsec &lt;usec&gt;</code></p><p>Minimum duration that a sample is queued for ACK-disabled readers. Only used if See <code>-noPositiveAcks</code> is specified on the publisher side.</p><p>See Disabling Positive Acknowledgements, Section 6.5.3.3 in the RTI Connext DDS Core Libraries User’s Manual.</p><p><strong>Default:</strong> <code>1000 µsec</code> (1 millisec).<br><strong>Range:</strong> <code>&gt;= 0</code>.</p></li><li><p><code>-keyed</code></p><p>Specify the use of a keyed type.</p><p><strong>Default:</strong> <code>Unkeyed</code> type.</p></li><li><p><code>-multicast</code></p><p>Use multicast to receive data.</p><p><strong>Default:</strong> do not use multicast.</p></li><li><p><code>-multicastAddress &lt;address&gt;</code></p><p>Specify the multicast receive address for receiving user data.</p><p>If unspecified, the following default values will be used according to the topic:</p><p><strong>latency:</strong> <code>239.255.1.2</code><br><strong>throughput:</strong> <code>239.255.1.1</code><br><strong>announcement:</strong> <code>239.255.1.100</code></p></li><li><p><code>-nic &lt;ipaddr&gt;</code></p><p>Restrict RTI Connext DDS to sending output through this interface. This can be the IP address of any available network interface on the machine.</p><p>By default, RTI Connext DDS will attempt to contact all possible subscribing nodes on all available network interfaces. Even on a multi-NIC machine, the performance over one NIC vs. another may be different (e.g., Gbit vs. 100 Mbit), so choosing the correct NIC is critical for a proper test.</p></li><li><p><code>-noDirectCommunication</code></p><p>Indicates if the subscribing application will receive samples from the publishing application when RTI Persistence Service is used.</p><p>Only applies when <code>-durability &lt;0|1|2|3&gt;</code> is <code>TRANSIENT (2)</code> or <code>PERSISTENT (3)</code>.</p><p>If set to <code>true</code> (the default), the subscribing application gets samples from the publishing application and <em>RTI Persistence Service</em>. This mode provides low latency between endpoints.</p><p>If set to <code>false</code>, the subscribing application only gets samples from <em>RTI Persistence Service</em>. This brokered communication pattern provides a way to guarantee eventual consistency.</p><p><strong>Default:</strong> <code>true</code> (direct communication)</p></li><li><p><code>-nomulticast</code></p><p>Do not use multicast.</p><p><strong>Note:</strong> Starting in 5.1.0, this option is no longer needed since multicast is disabled by default. It exists only to maintain backward compatibility.</p><p><strong>Default:</strong> Do not use multicast</p></li><li><p><code>-noPositiveAcks</code></p><p>Disable use of positive ACKs in the reliable protocol.</p><p><strong>Default:</strong> <code>true</code> (use positive ACKs)</p><p>See <code>-qosprofile &lt;filename&gt;</code> option for more information.</p></li><li><p><code>-noPrintIntervals</code></p><p>Prevent printing of statistics at intervals during the test.</p><p>By default, statistics are printed every second in the subscribing application, and after receiving every latency echo in the publishing application.</p></li><li><p><code>-qosprofile &lt;filename&gt;</code></p><p>Path to the XML file containing DDS QoS profiles.</p><p><strong>Default:</strong> <code>perftest_qos_profiles.xml</code></p><p>The default file contains these QoS profiles:<br>The <code>ThroughputQos</code>, <code>LatencyQos</code>, and <code>AnnouncementQos</code> profiles are used by default.<br>The <code>NoAckThroughputQos</code> and <code>NoAckLatencyQos</code> profiles are used if you specify <code>-noPositiveAcks</code>.</p><p><strong>Note:</strong> some QoS values are ‘hard-coded’ in the application, therefore setting them in the XML file has no effect; see the See Note:.</p><p>See comments in <code>perftest_qos_profiles.xml</code>, as well as <strong>Configuring QoS with XML, Chapter 17</strong> in the <em>RTI Connext DDS Core Libraries</em> User’s Manual.</p></li><li><p><code>-useReadThread</code></p><p>Use a separate thread (instead of a callback) to read data.</p><p>See See WaitSet Event Count and Delay</p><p><strong>Default:</strong> use callback for subscriber</p></li><li><p><code>-waitsetDelayUsec &lt;usec&gt;</code></p><p>Process incoming data in groups, based on time, rather than individually.</p><p>Only used if the See <code>-useReadThread</code> option is specified on the subscriber side.</p><p>See WaitSet Event Count and Delay.</p><p><strong>Default:</strong> <code>100</code><br><strong>Range:</strong> <code>&gt;= 0</code></p></li><li><p><code>-waitsetEventCount &lt;count&gt;</code></p><p>Process incoming data in groups, based on the number of samples, rather than individually.</p><p>Only used if the See <code>-useReadThread</code> option is specified on the subscriber side.</p><p>See See WaitSet Event Count and Delay.</p><p><strong>Default:</strong> <code>5</code> <strong>Range:</strong> <code>&gt;= 1</code></p></li></ul><h3 id="test-parameters-only-for-publishing-applications-a-id-params-pub-a-">Test Parameters Only for Publishing Applications <a id="params-pub"></a></h3><ul><li><p><code>-batchSize &lt;bytes&gt;</code></p><p>Enable batching and set the maximum batched message size.</p><p><strong>Default:</strong> <code>0</code> (batching disabled)<br><strong>Range:</strong> <code>1 to 63000</code></p><p>For more information on batching data for high throughput, see the <strong>High Throughput design pattern</strong> in the <em>RTI Connext DDS Core Libraries Getting Started Guide</em>. See also: <strong>How to Measure Latency for a Given Throughput and the BATCH QosPolicy, Section 6.5.2</strong> in the <em>RTI Connext DDS Core Libraries Getting User’s Manual</em>.</p></li><li><p><code>-enableAutoThrottle</code></p><p>Enable the Auto Throttling feature. See Auto Tuning and Turbo Mode.</p><p><strong>Default:</strong> feature is disabled.</p></li><li><p><code>-enableTurboMode</code></p><p>Enables the Turbo Mode feature. See See Auto Tuning and Turbo Mode. When turbo mode is enabled, See <code>-batchSize &lt;bytes&gt;</code> is ignored.</p><p><strong>Default:</strong> feature is disabled.</p></li><li><p><code>-executionTime &lt;sec&gt;</code></p><p>Allows you to limit the test duration by specifying the number of seconds to run the test.</p><p><strong>Default:</strong> feature is not set.</p></li><li><p><code>-heartbeatPeriod &lt;sec&gt;:&lt;nanosec&gt;</code></p><p>The period at which the publishing application will send heartbeats.</p><p>See <strong>Reliable Communications, Chapter 10</strong>, in the <em>RTI Connext DDS Core Libraries Getting User’s Manual</em>.</p><p><strong>Default:</strong> <code>heartbeat period sec = 0</code>, <code>heartbeat period nanosec = 0</code> (meaning use the value as specified in the XML QoS Profile, which is set to (10 millisec = 10000000 nanosec)).</p><p>See <code>-qosprofile &lt;filename&gt;</code>.</p><p><strong>Range:</strong> 1 nanosec to 1 year (31,536,000 sec.)</p></li><li><p><code>-fastHeartbeatPeriod &lt;sec&gt;:&lt;nanosec&gt;</code></p><p>An alternative heartbeat period used when the publishing application needs to flush unacknowledged samples more quickly.</p><p>See <strong>Reliable Communications, Chapter 10</strong>, in the <em>RTI Connext DDS Core Libraries Getting User’s Manual</em>.</p><p><strong>Default:</strong> <code>heartbeat period sec = 0</code>, <code>heartbeat period nanosec = 0</code> (meaning use the value as specified in the XML QoS Profile, which is set to (1 millisec = 1000000 nanosec)). See</p><p>See <code>-qosprofile &lt;filename&gt;</code>.</p><p><strong>Range:</strong> (actual value) <code>1 nanosec</code> to <code>1 year (31,536,000 sec)</code>. Must not be slower than See <code>-heartbeatPeriod &lt;sec&gt;:&lt;nanosec&gt;</code>.</p></li><li><p><code>-latencyCount &lt;count&gt;</code></p><p>Number samples to send before a latency ping packet is sent.</p><p>See Number of Iterations vs. Latency Count.</p><p><strong>Default:</strong> <code>-1</code> (if <code>-latencyTest</code> is not specified, automatically adjust to 10000; if -latency Test is specified, automatically adjust to 1).</p><p><strong>Range:</strong> must be <code>&lt;= -numIter</code></p></li><li><p><code>-latencyTest</code></p><p>Run a latency test consisting of a ping-pong.</p><p>The publisher sends a ping, then blocks until it receives a pong from the subscriber.</p><p>Can only be used on a publisher whose <code>pidMultiPubTest = 0</code> (see See <code>-pidMultiPubTest &lt;id&gt;</code>).</p><p><strong>Default:</strong> <code>false</code></p></li><li><p><code>-numIter &lt;count&gt;</code></p><p>Number of samples to send.</p><p>See Number of Iterations vs. Latency Count and See Warming Up.</p><p>If you set <code>scan</code> = <code>true</code>, you cannot set this option (See <code>-scan</code>).</p><p><strong>Default:</strong> <code>0</code> (infinite)<br><strong>Range:</strong> <code>latencyCount</code> (adjusted value) or higher (see <code>-latencyCount &lt;count&gt;</code>).</p></li><li><p><code>-numSubscribers &lt;count&gt;</code></p><p>Have the publishing application wait for this number of subscribing applications to start.</p><p><strong>Default:</strong> <code>1</code></p></li><li><p><code>-pidMultiPubTest &lt;id&gt;</code></p><p>Set the ID of the publisher in a multi-publisher test.</p><p>Use a unique value for each publisher running on the same host that uses the same domain ID.</p><p><strong>Default:</strong> <code>0</code><br><strong>Range:</strong> <code>0 to n-1</code>, inclusive, where n is the number of publishers in a multi-publisher test.</p></li><li><p><code>-pub</code></p><p>Set test to be a publisher.</p><p><strong>Default:</strong> <code>-sub</code></p></li><li><p><code>-pubRate</code></p><p>Limit the throughput to the specified number of samples per second.</p><p><strong>Default:</strong> <code>0</code> (no limit)<br><strong>Range:</strong> <code>1 to 10000000</code></p></li><li><p><code>-scan</code></p><p>Run test in scan mode, traversing a range of sample data sizes from 32 to 63,000 bytes.</p><p>If you set <code>scan = true</code>, you cannot set <code>-numIter &lt;count&gt;</code>.</p><p><strong>Default:</strong> <code>false</code> (no scan)</p></li><li><p><code>-sendQueueSize &lt;number&gt;</code></p><p>Size of the send queue.</p><p>When <code>-batchSize &lt;bytes&gt;</code> is used, the size is the number of batches.</p><p>See Send-Queue Size and Queue-Full Behavior.</p><p><strong>Default:</strong> <code>50</code><br><strong>Range:</strong> <code>[1-100 million]</code> or <code>-1</code> (indicating an unlimited length).</p></li><li><p><code>-sleep &lt;millisec&gt;</code></p><p>Time to sleep between each send.</p><p>See Spinning vs. Sleeping.</p><p><strong>Default:</strong> <code>0</code><br><strong>Range:</strong> <code>0</code> or higher</p></li><li><p><code>-spin &lt;count&gt;</code></p><p>Number of times to run in a spin loop between each send.</p><p>See Spinning vs. Sleeping.</p><p><strong>Default:</strong> <code>0</code><br><strong>Range:</strong> <code>0</code> or higher</p></li></ul><h3 id="test-parameters-only-for-subscribing-applications-a-id-params-sub-a-">Test Parameters Only for Subscribing Applications <a id="params-sub"></a></h3><ul><li><p><code>-numPublishers &lt;count&gt;</code></p><p>The subscribing application will wait for this number of publishing applications to start.</p><p><strong>Default:</strong> <code>1</code></p></li><li><p><code>-sidMultiSubTest &lt;id&gt;</code></p><p>ID of the subscriber in a multi-subscriber test.</p><p>Use a unique value for each subscriber running on the same host that uses the same domain ID.</p><p><strong>Default:</strong> <code>0</code><br><strong>Range:</strong> <code>0 to n-1</code>, inclusive, where n is the number of subscribers in a multi-subscriber test.</p></li><li><p><code>-sub</code></p><p>Set test to be a subscriber.</p><p><strong>Default:</strong> <code>-sub</code></p></li></ul><h3 id="test-parameters-to-control-rti-secure-dds-options-publishing-and-subscribing-applications-a-id-params-pub-sub-secure-a-">Test Parameters to Control RTI Secure DDS Options (Publishing and Subscribing Applications) <a id="params-pub-sub-secure"></a></h3><ul><li><p><code>-secureEncryptDiscovery</code></p><p>Encrypt discovery traffic.</p><p><strong>Default:</strong> Not set.</p></li><li><p><code>-secureSign</code></p><p>Sign discovery and user data packages.</p><p><strong>Default:</strong> Not set.</p></li><li><p><code>-secureEncryptData</code></p><p>Encrypt at the user data level.</p><p><strong>Default:</strong> Not set.</p></li><li><p><code>-secureEncryptSM</code></p><p>Encrypt at the RTPS sub-message level.</p><p><strong>Default:</strong> Not set.</p></li><li><p><code>-secureGovernanceFile &lt;file&gt;</code></p><p>Governance file. If specified, the authentication, signing, and encryption arguments are ignored. The governance document configuration will be used instead.</p><p><strong>Default:</strong> Not set.</p></li><li><p><code>-securePermissionsFile &lt;file&gt;</code></p><p>Permissions file to be used.</p><p><strong>Default for Publisher:</strong> <code>./resource/secure/signed_PerftestPermissionsPub.xml</code><br><strong>Default for Subscriber:</strong> <code>./resource/secure/signed_PerftestPermissionsSub.xml</code></p></li><li><p><code>-secureCertAuthority &lt;file&gt;</code></p><p>Certificate authority file to be used.</p><p><strong>Default for Publisher:</strong> <code>./resource/secure/pub.pem</code><br><strong>Default for Subscriber:</strong> <code>./resource/secure/sub.pem</code></p></li><li><p><code>-secureCertFile &lt;file&gt;</code></p><p>Certificate file to be used.</p><p><strong>Default:</strong> <code>./resource/secure/cacert.pem</code></p></li><li><p><code>-securePrivateKey &lt;file&gt;</code></p><p>Private key file to be used.</p><p><strong>Default for Publisher:</strong> <code>./resource/secure/pubkey.pem</code> <strong>Default for Subscriber:</strong> <code>./resource/secure/subkey.pem</code></p></li></ul><h3 id="additional-information-about-the-parameters">Additional information about the parameters</h3><h4 id="spinning-vs-sleeping-a-id-sleepvsspin-a-">Spinning vs. Sleeping <a id="sleepVsSpin"></a></h4><p>When the publisher is writing as fast as it can, sooner or later, it is likely to get ahead of the subscriber. There are 4 things you can do in this case:</p><ol><li><p>Nothing -- for reliable communication, <code>write()</code> will block until the subscriber(s) catch up.</p></li><li><p>Slow the writing down by sleeping (See <code>-sleep &lt;millisec&gt;</code>). This approach is friendlier to the other processes on the host because it does not monopolize the CPU. However, context switching is expensive enough that you can&#39;t actually "sleep" for amounts of time on the order of microseconds, so you could end up sleeping too long and hurting performance. (Operating systems (including Linux and Windows) have a minimum resolution for sleeping; i.e., you can only sleep for a period of 1 or 10 ms. If you specify a sleep period that is less than that minimum, the OS may sleep for its minimum resolution.)</p></li><li><p>Spin in a tight loop between writes (See <code>-spin &lt;count&gt;</code>). This approach will add a pause without giving up the CPU, making it easier to "sleep" for very short periods of time. In the test implementation, there is a very short loop that just performs some simple math to take up CPU time. The argument to <code>-spin &lt;count&gt;</code> (any number &gt;= 0) is the number of times to go through that loop. The default is 0. If you specify something else, it should be a fairly large number (100’s or 1000’s), since spinning the loop just a few times will take negligible time. Avoid spinning on a single-core machine, as the code that would break you out of the spin may not be able to execute in a timely manner.</p></li><li><p>Let the publisher automatically adjust the writing rate (See <code>-enableAutoThrottle</code>). This option enables the Auto Throttle feature introduced in RTI Connext DDS 5.1.0 and its usage is preferred over See <code>-spin &lt;count&gt;</code> because the amount of spin is automatically determined by the publisher based on the number of unacknowledged samples in the send queue.</p></li></ol><p>See also: Send-Queue Size and Queue-Full Behavior.</p><h4 id="send-queue-size-and-queue-full-behavior-a-id-queuesize-a-">Send-Queue Size and Queue-Full Behavior <a id="queueSize"></a></h4><p>In many distributed systems, a data producer will often outperform data consumers. That means that, if the communications are to be reliable, the producer must be throttled in some way to allow the consumers to keep up. In some situations, this may not be a problem, because data may simply not be ready for publication at a rate sufficient to overwhelm the subscribers. If you&#39;re not so lucky, your publisher&#39;s queue of unacknowledged data will eventually fill up. When that happens, if data is not to be lost, the publication will have to block until space becomes available. Blocking can cost you in terms of latency.</p><p>To avoid the cost of blocking, consider the following:</p><ul><li><p>Enlarge your publisher&#39;s queue (See <code>-sendQueueSize &lt;number&gt;</code>). Doing so will mean your publisher has to block less often. However, it may also let the publisher get even further ahead of slower subscribers, increasing the number of dropped and resent packets, hurting throughput. Experimenting with the send queue size is one of the easy things you can do to squeeze a little more throughput from your system.</p></li><li><p>Enable Auto Throttling (See <code>-enableAutoThrottle</code>). This option enables the Auto Throttle feature introduced in <em>RTI Connext DDS 5.1.0</em>. When this option is used, the publisher automatically adjusts the writing rate based on the number of unacknowledged samples in the send queue to avoid blocking.</p></li></ul><p><strong>Note:</strong></p><p>The following values in the <code>DataWriterProtocolQosPolicy</code> are ‘hard-coded’ in the application, therefore setting these values in the XML QoS profile will have no effect:</p><ul><li><code>rtps_reliable_writer.heartbeats_per_max_samples</code> is set to (<code>sendQueueSize/10</code>)</li><li><code>rtps_reliable_writer.low_watermark</code> is set to (<code>sendQueueSize * 0.10</code>)</li><li><code>rtps_reliable_writer.high_watermark</code> is set to (<code>sendQueueSize * 0.90</code>)</li></ul><p>For more information on the send queue size, see the <code>RESOURCE_LIMITS</code> QosPolicy, <strong>Section 6.5.20</strong> in the <em>RTI Connext DDS Core Libraries User’s Manual</em> (specifically, the <code>max_samples</code> field).</p><h4 id="number-of-iterations-vs-latency-count-a-id-iterationsvslatencycount-a-">Number of Iterations vs. Latency Count <a id="iterationsVsLatencyCount"></a></h4><p>When configuring the total number of samples to send during the test (See <code>-numIter &lt;count&gt;</code>) and the number of samples to send between latency pings (See <code>-latencyCount &lt;count&gt;</code>), keep these things in mind:</p><ul><li><p>Don&#39;t send latency pings too often. One of the purposes of the test is to measure the throughput that the middleware is able to achieve. Although the total throughput is technically the total data sent on both the throughput and latency topics, for the sake of simplicity, the test measures only the former. The implicit assumption is that the latter is negligible by comparison. If you violate this assumption, your throughput test results will not be meaningful.</p></li><li><p>Keep the number of iterations large enough to send many latency pings over the course of the test run. Your latency measurements, and the spread between them, will be of higher quality if you are able to measure more data points.</p></li><li><p>When selecting See <code>-numIter &lt;count&gt;</code>, choose a value that allows the test to run for at least a minute to get accurate results. Set See <code>-numIter &lt;count&gt;</code> to be millions for small message sizes (&lt;1k); reduce as needed for larger sizes (otherwise the tests will take longer and longer to complete).</p></li></ul><h4 id="warming-up-a-id-warmup-a-">Warming Up <a id="warmUp"></a></h4><p>When running the performance test in <em>Java</em>, and to a lesser extent, <em>C#</em>, you may observe that throughput slowly increases through the first few incremental measurements and then levels off. This improvement reflects the background activity of the just-in-time (JIT) compiler and optimizer on these platforms. For the best indication of steady-state performance, be sure to run the test for a number of samples (See <code>-numIter &lt;count&gt;</code>) sufficient to smooth out this start-up artifact.</p><h4 id="waitset-event-count-and-delay-a-id-waitseteventcount-a-">WaitSet Event Count and Delay <a id="WaitSetEventCount"></a></h4><p><em>RTI Connext DDS</em>, and by extension, this performance test, gives you the option to either process received data in the middleware&#39;s receive thread, via a listener callback, or in a separate thread (See <code>-useReadThread</code>) via an object called a WaitSet. The latter approach can be beneficial in that it decouples the operation of your application from the middleware, so that your processing will not interfere with <em>Connext DDS</em>&#39;s internal activities. However, it does introduce additional context switches into your data receive path. When data is arriving at a high rate, these context switches can adversely impact performance when they occur with each data sample.</p><p>To improve efficiency, the command line parameters <code>-waitsetDelayUsec &lt;usec&gt;</code> and <code>-waitsetEventCount &lt;count&gt;</code> allow you to process incoming data in groups, based on the number of samples and/or time, rather than individually, reducing the number of context switches. Experiment with these values to optimize performance for your system.</p><p>For more information, see these sections in the <em>RTI Connext DDS Core Libraries User’s Manual</em>: <strong>Receive Threads (Section 19.3)</strong> and <strong>Conditions and WaitSets (Section 4.6)</strong>.</p><h4 id="how-to-measure-latency-for-a-given-throughput-a-id-lat-a-">How to Measure Latency for a Given Throughput <a id="lat"></a></h4><p>If you want to measure the minimum latency for a given throughput, you have to use the command-line parameters <code>-sleep &lt;millisec&gt;</code>, <code>-spin &lt;count&gt;</code> and <code>-batchSize &lt;bytes&gt;</code> to experimentally set the throughput level for a given test run.</p><p>For example, suppose you want to generate a graph of latency vs. throughput for a packet size of <code>200 bytes</code> and throughput rates of <code>1000</code>, <code>10K</code>, <code>20K</code>, <code>50K</code>, <code>100K</code>, <code>500K</code>, and <code>Max messages</code> per second.</p><p>For throughput rates under 1000 messages per second, use <code>-sleep &lt;ms&gt;</code> to throttle the publishing application. For example, <code>-sleep 1</code> will produce a throughput of approximately 1000 messages/second; <code>-sleep 2</code> will produce a throughput of approximately 500 messages/second.</p><p>For throughput rates higher than 1000 messages per second, use <code>-spin &lt;spin count&gt;</code> to cause the publishing application to busy wait between sends. The <code>&lt;spin count&gt;</code> value needed to produce a given throughput must be experimentally determined and is highly dependent on processor performance. For example <code>-spin 19000</code> may produce a message rate of 10000 messages/second with a slow processor but a rate of 14000 messages/second with a faster processor.</p><p>Use batching when you want to measure latency for throughput rates higher than the maximum rates of sending individual messages. First, determine the maximum throughput rate for the data size under test without batching (omit See <code>-batchSize &lt;bytes&gt;</code>). For example, on a 1-Gigabyte network, for a data size of <code>200 bytes</code>, the maximum throughput will be about 70,000 messages/sec. We will refer to this value as <code>max_no_batch</code>.</p><p>For all throughput rates less than <code>max_no_batch</code> (e.g., 70,000 messages/sec.), do not use batching, as this will increase the latency.</p><p>Use batching to test for throughput rates higher than <code>max_no_batch</code>: start by setting <code>-batchSize</code> to a multiple of the data size. For example, if the data size is <code>200 bytes</code>, use <code>-batchSize 400</code> (this will put 2 messages in each batch), <code>-batchSize 800</code> (4 per batch), etc. This will allow you to get throughput/latency results for throughputs higher than the <code>max_no_batch</code> throughput rate.</p><p><strong>Note:</strong> For larger data sizes (<code>8000 bytes</code> and higher), batching often does not improve throughput, at least for 1-Gigabyte networks.</p><h4 id="auto-tuning-and-turbo-mode-a-id-autotuningturbomode-a-">Auto Tuning and Turbo Mode <a id="AutoTuningTurboMode"></a></h4><p><em>RTI Connext DDS 5.1.0</em> includes two features that allow the middleware to auto-tune the communications to achieve better performance. These features are <strong>Auto Throttling</strong> and <strong>Turbo Mode</strong>. For more information about both features, refer to <strong>Sections 10.4, Auto Throttling for DataWriter Performance -- Experimental Feature</strong> and <strong>6.5.2.4 Turbo Mode: Automatically Adjusting the Number of Bytes in a Batch -- Experimental</strong> Feature in the <em>RTI Connext DDS Core Libraries User&#39;s Manual</em>. The performance test application includes two command-line options to enable these features: <code>-enableAutoThrottle</code> and <code>-enableTurboMode</code>.</p><p>With Auto Throttling, the publisher automatically adjusts the writing rate based on the number of unacknowledged samples in the send queue to avoid blocking and provide the best latency/throughput tradeoff.</p><p>With Turbo Mode, the size of a batch is automatically adjusted to provide the best latency for a given write rate. For slow write rates, the batch size will be smaller to minimize the latency penalty. For high write rates, the batch size will be bigger to increase throughput. When turbo mode is used, the command line option See <code>-batchSize &lt;bytes&gt;</code> is ignored.</p><p>To achieve the best latency under maximum throughput conditions, use See <code>-enableAutoThrottle</code> and See <code>-enableTurboMode</code> in combination.</p></div><div class="page-header"><h3 id="10-Command-Line-Examples"><a href="#10-Command-Line-Examples">10 Command-Line Examples</a></h3><p>The followings are examples of how to run the performance test for different use cases.</p><ul><li><p>The tests below print final results only; if you want to see intermediate values, remove the <code>-noprint</code> argument from the command line.</p></li><li><p>If you are running on 2 unequal machines, i.e., one machine is faster (has better processors) than another, you will see better performance by running the Publisher on the slower machine.</p></li><li><p>To measure CPU usage while running these tests, use "top" or a similar utility.</p></li></ul><h3 id="1-to-1-multicast-best-latency-as-a-function-of-message-size">1-to-1, Multicast, Best Latency as a Function of Message Size</h3><ul><li>Publisher:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -pub -noPrint -nic &lt;ipaddr&gt; -domain &lt;ID&gt; -latencyCount 1 -dataLen &lt;length&gt; -latencyTest -multicast -executionTime 100
</code></pre><ul><li>Subscriber:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -sub -noPrint -nic &lt;ipaddr&gt; -domain &lt;ID&gt; -multicast
</code></pre><p>Modify <code>-dataLen &lt;bytes&gt;</code> to see latencies for different data sizes. Set <code>-executionTime &lt;seconds&gt;</code> to be &gt;=100 for statistically better results.</p><h3 id="1-to-1-multicast-maximum-throughput-as-a-function-of-message-size-with-batching-">1-to-1, Multicast, Maximum Throughput as a Function of Message Size (with Batching)</h3><ul><li>Publisher:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -pub -noPrint -nic &lt;ipaddr&gt; -dataLen &lt;length&gt; -batchSize &lt;bytes&gt; -sendQueueSize &lt;number&gt; -multicast -executionTime 100
</code></pre><ul><li>Subscriber:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -sub -noprint -nic &lt;ipaddr&gt; -multicast
</code></pre><p>To achieve maximum throughput, start by setting See <code>-batchSize &lt;bytes&gt;</code> to <code>6400</code>, then increase the size to see if you get better throughput.</p><p>The largest valid batch size is <code>63000 bytes</code>.</p><p>For maximum throughput, start by setting <code>-sendQueueSize &lt;number&gt;</code> to <code>30</code>; the best value will usually be between <code>30-50</code>.</p><p>Note: For larger data sizes (<code>8000 bytes</code> and higher), batching often does not improve throughput, at least for 1-Gig networks.</p><h3 id="1-to-1-multicast-latency-vs-throughput-for-200-byte-messages-with-batching-">1-to-1, Multicast, Latency vs. Throughput for 200-byte Messages (with Batching)</h3><ul><li>Publisher:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -pub -noPrint -nic &lt;ipaddr&gt; -dataLen 200 -batchSize &lt;bytes&gt; -sendQueueSize &lt;number&gt; -spin &lt;count&gt; -multicast -executionTime 100
</code></pre><ul><li>Subscriber</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -sub -noPrint -nic &lt;ipaddr&gt; -multicast
</code></pre><p>To adjust throughput, experiment with the value of <code>-spin &lt;count&gt;</code>. For example, to get a rate of 10,000 messages/sec, use <code>-spin 20000</code> to see the resulting rate, then adjust up or down as needed.</p><h3 id="1-to-1-multicast-reliable-udpv4-all-sizes">1-to-1, Multicast, Reliable UDPv4, All Sizes</h3><ul><li>Publisher:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -pub -noPrint -sendQueueSize 32 -latencyCount 10000 -scan -multicast
</code></pre><ul><li>Subscriber:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -sub -noPrint -multicast
</code></pre><h3 id="1-to-1-unicast-best-effort-udpv4-1-size">1-to-1, Unicast, Best-Effort, UDPv4, 1 Size</h3><ul><li>Publisher:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -pub -noPrint -sendQueueSize 32  -latencyCount 1000 -dataLen 1024 -bestEffort -executionTime 100
</code></pre><ul><li>Subscriber</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -sub -noPrint -dataLen 1024 -bestEffort
</code></pre><h3 id="1-to-1-multicast-reliable-udpv4-batching-enabled">1-to-1, Multicast, Reliable, UDPv4, Batching Enabled</h3><ul><li>Publisher:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -pub -noPrint -sendQueueSize 32 -latencyCount 1000 -dataLen 200 -batchSize 6400  -multicast -executionTime 100
</code></pre><ul><li>Subscriber:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -sub -noPrint -dataLen 200 -batchSize 6400 -multicast
</code></pre><h3 id="1-to-2-multicast-reliable-udpv4">1-to-2, Multicast, Reliable, UDPv4</h3><ul><li>Publisher:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -pub -noPrint -pidMultiPubTest 0 -sendQueueSize 32 -numSubscribers 2 -latencyCount 1000 -dataLen 200 -multicast -executionTime 100
</code></pre><ul><li>Subscriber 1:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -sub -noPrint -dataLen 200 -batchSize 6400 -multicast
</code></pre><ul><li>Subscriber 2:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -sub -noPrint -dataLen 200 -batchSize 6400 -multicast
</code></pre><h3 id="2-to-1-multicast-reliable-udpv4">2-to-1, Multicast, Reliable, UDPv4</h3><ul><li>Publisher 1:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -pub -noPrint -pidMultiPubTest 0 -sendQueueSize 32 -numSubscribers 1 -latencyCount 1000 -dataLen 200 -multicast -executionTime 100
</code></pre><ul><li>Publisher 2:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -pub -noPrint -pidMultiPubTest 1 -sendQueueSize 32 -numSubscribers 1 -latencyCount 1000 -dataLen 200 -multicast -executionTime 100
</code></pre><ul><li>Subscriber:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -sub -noPrint -dataLen 200 -numPublishers 2 -sidMultiSubTest 0 -multicast
</code></pre><h3 id="1-to-1-unicast-reliable-udpv4-using-security-signing-packages-encrypting-data">1-to-1, Unicast, Reliable, UDPv4, Using Security: Signing Packages, Encrypting Data</h3><ul><li>Publisher:</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -pub -noPrint -dataLen 63000 -secureSign -secureEncryptData -executionTime 100
</code></pre><ul><li>Subscriber</li></ul><pre><code>bin/&lt;arch&gt;/Release/perftest_cpp -sub -noPrint -dataLen 63000 -secureSign -secureEncryptData
</code></pre></div><div class="page-header"><h3 id="11-Output-Example"><a href="#11-Output-Example">11 Output Example</a></h3><p>The following is an example of the expected output from the performance test.</p><ul><li>Publisher:</li></ul><pre><code>&gt; perftest_cpp -pub -noPrint -domain 27 -sendQueueSize 50 -latencyCount 10000 -scan Waiting to discover 1 subscribers... 
Waiting for subscribers announcement ...
Publishing data...
Length: 32 Latency: Ave 396 us Std 48.9 us Min 83 us Max 538 us 50% 401 us 90% 459 us 99% 510 us 99.99% 538 us 99.9999% 538 us
Length: 64 Latency: Ave 399 us Std 53.1 us Min 88 us Max 1062 us 50% 403 us 90% 461 us 99% 537 us 99.99% 1062 us 99.9999% 1062 us
...
</code></pre><ul><li>Subscriber</li></ul><pre><code>&gt; bin/i86Linux2.6gcc3.4.3/Release/perftest_cpp -sub -noPrint -domain 27
Waiting to discover 1 publishers ...
Waiting for data...
Length: 32 Packets: 10000000 Packets/s(ave): 47913 Mbps(ave): 12.3 Lost: 0
Length: 64 Packets: 10000000 Packets/s(ave): 47580 Mbps(ave): 24.4 Lost: 0
...
</code></pre></div><div class="page-header"><h3 id="12-Secure-Certificates--Governance-and-Permission-Files"><a href="#12-Secure-Certificates--Governance-and-Permission-Files">12 Secure Certificates, Governance and Permission Files</a></h3><p>The performance test provides a set of already generated certificates, governance and permission files to be loaded when using the RTI Secure DDS plugin. Both governance files and permission files are already signed, so no action is required by the user. These files are located in <code>$(RTIPERFTESTHOME)/resource/certificates</code>.</p><p>In addition to the already signed governance and permission files, the original files are also provided (not signed) as well as a <code>bash</code> script with the steps to generate all the signed files. Those files can be found in <code>$(RTIPERFTESTHOME)/resource/certificates/input</code>; the script is in <code>$(RTIPERFTESTHOME)/resource/certificates/make.sh</code>.</p></div><div class="page-header"><h3 id="13-Optimizing-Your-OS-for-Network-Performance"><a href="#13-Optimizing-Your-OS-for-Network-Performance">13 Optimizing Your OS for Network Performance</a></h3><p>The network stacks of popular operating systems are not always tuned for maximum performance out of the box. RTI has found that the following configuration changes frequently improve performance for a broad set of demanding applications. Consider testing your network performance with and without these changes to learn if they can benefit your system.</p><h3 id="optimizing-linux-systems">Optimizing Linux Systems</h3><p>Edit the file <code>/etc/sysctl.conf</code> and add the following:</p><pre><code>net.core.wmem_max = 16777216
net.core.wmem_default = 16777216
net.core.rmem_max = 16777216
net.core.rmem_default = 16777216
net.ipv4.tcp_rmem = 4096 16777216 33554432
net.ipv4.tcp_wmem = 4096 16777216 33554432
net.ipv4.tcp_mem = 4096 16777216 33554432
run /sbin/sysctl -p
</code></pre><h3 id="optimizing-windows-systems">Optimizing Windows Systems</h3><ol><li><p>From the Start button, select Run..., then enter <code>regedit</code>.</p></li><li><p>Change this entry: <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\
Services\Tcpip\Parameters</code></p><ul><li>Add the <code>DWORD</code> key: <code>MaximumReassemblyHeaders</code></li><li>Set the value to <code>0xffff</code> (this is the max value)</li><li>See <a href="http://support.microsoft.com/kb/811003">http://support.microsoft.com/kb/811003</a> for more information.</li></ul></li><li><p>Change this entry: <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\
Services\AFD\Parameters</code></p><ul><li>Add the <code>DWORD</code> key: <code>FastSendDatagramThreshold</code></li><li>Set the value to <code>65536</code> (<code>0x10000</code>) See <a href="http://support.microsoft.com/kb/235257">http://support.microsoft.com/kb/235257</a> for more information.</li></ul></li><li><p>Reboot your machine for the changes to take effect.</p></li></ol></div></div><div class="col-md-3"><div id="sidebar" class="hidden-print affix" role="complementary"><ul class="nav nav-pills nav-stacked"><li><a href="#1-Testing-Performance">1 Testing Performance</a></li><li><a href="#2-Supported-Platforms">2 Supported Platforms</a></li><li><a href="#3-Release-Notes">3 Release Notes</a></li><li><a href="#4-Overview">4 Overview</a></li><li><a href="#5-Download-Instructions">5 Download Instructions</a></li><li><a href="#6-Code-Generation-And-Compilation">6 Code Generation And Compilation</a></li><li><a href="#7-Modify-RTI-Perftest-for-Larger-Samples">7 Modify RTI Perftest for Larger Samples</a></li><li><a href="#8-Test-execution">8 Test execution</a></li><li><a href="#9-Test-Parameters">9 Test Parameters</a></li><li><a href="#10-Command-Line-Examples">10 Command-Line Examples</a></li><li><a href="#11-Output-Example">11 Output Example</a></li><li><a href="#12-Secure-Certificates--Governance-and-Permission-Files">12 Secure Certificates, Governance and Permission Files</a></li><li><a href="#13-Optimizing-Your-OS-for-Network-Performance">13 Optimizing Your OS for Network Performance</a></li></ul></div></div></div></div></body></html>